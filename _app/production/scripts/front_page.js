import{S as B}from"./settings.js";const G=async A=>{let p=A.querySelectorAll(".text > span"),E=!1,L=document.querySelector(".c-sound_popup"),g={ok:document.querySelector(".c-sound_popup__button--ok"),ng:document.querySelector(".c-sound_popup__button--dont-allow")};Array.prototype.shuffle=function(){let t=this.length;for(;t;){let e=Math.floor(Math.random()*t),s=this[--t];this[t]=this[e],this[e]=s}return this};let y=[];p.forEach((t,e)=>{y.push(e)}),y.shuffle();const _=()=>{p.forEach((t,e)=>{setTimeout(function(){t.classList.add("is-disp"),t.classList.add("is-blink"),setTimeout(function(){t.classList.remove("is-blink"),setTimeout(function(){t.classList.add("is-glitch"),t.classList.add("is-no-transition"),E=!0},800)},800)},210*y[e])})},l=A.querySelector("canvas"),o=l.getContext("2d"),z=B.path.asset+B.path.audio+"/breakbot/mystery/mix.mp3",u=new(window.AudioContext||window.webkitAudioContext),a=u.createAnalyser();let M=new XMLHttpRequest;const T=980;let r=window.innerWidth,i=window.innerHeight,C=Date.now(),F=Math.random()*800,c,d=!1;const f=[["#000000","#000000"],["#A64E57","#529AA8"],["#23A7F3","#F1EADC"],["#A4C27B","#284C50"],["#E21E4F","#F4CB06"],["#72ECE5","#F40F0D"],["#F5F5F5","#EA6B5F"],["#EDFD1F","#1291C6"],["#002876","#FFD30A"],["#F6E7CD","#B5978E"],["#1ECADD","#DA9CA5"],["#2B3342","#9E9570"]];c=f[0];const S=function(t){L.remove(),_(),D(),q(),t&&H(),document.addEventListener("resize",()=>{q()})},H=function(){a.fft_size=T,a.connect(u.destination),P()},P=function(){const t=new XMLHttpRequest;t.open("GET",z,!0),t.responseType="arraybuffer",t.onload=function(){u.decodeAudioData(t.response,function(e){M=e,W()})},t.send()},W=function(){const t=u.createBufferSource();t.buffer=M,t.connect(a),t.loop=!0,t.start(0)},R=function(){let t=new Uint8Array(a.frequencyBinCount),e=0,s=1,h=Date.now(),m=h-C,w=.609,b=0,k=256;a.getByteTimeDomainData(t),e=a.frequencyBinCount;for(let n=0;n<e;n++)b<t[n]&&(b=t[n]),k>t[n]&&(k=t[n]);if(Math.random()<.01){const n=Math.random()*.1+.3;Math.random()<.5?w-=n:w+=n}m>F&&(Math.random()<.85?c=f[0]:c=f[Math.floor(Math.random()*f.length)],F=Math.random()*800,C=h),o.fillStyle=c[0],o.rect(0,0,r,i),o.fill(),o.fillStyle=c[1],o.lineWidth=1,o.strokeStyle="#ffffff",o.beginPath();for(let n=0;n<e;n++){const v=n/T*r,x=Math.log(256-t[n])/Math.log(256)*i*w;n===0?o.moveTo(v,x):o.lineTo(v,x)}o.lineTo(r+s,i+s),o.lineTo(-s,i+s),o.fill(),o.stroke()},$=function(){p.forEach(t=>{if(Math.random()<.0025){const e=Math.random();e<.33?t.style.transform="scale(1, -1)":e<.66?t.style.transform="scale(-1, 1)":t.style.transform="scale(-1, -1)",setTimeout(()=>{t.style.transform="scale(1, 1)"},20)}if(Math.random()<.0025){const e=t.querySelector(":scope > span"),s=Math.random(),h=s*5,m=s*(0- -100)+-100;e.style.transform=`scale(${h}) translate3d(${m}%, ${m}%, 0)`,setTimeout(()=>{e.style.transform="scale(1) translate3d(-50%, -50%, 0)"},20)}})},X=function(){o.clearRect(0,0,r,i),R(),E&&$()},D=function(){requestAnimationFrame(D),X()},q=function(){r=window.innerWidth*2,i=window.innerHeight*2,l.width=r,l.height=i,l.style.width=r/2+"px",l.style.height=i/2+"px"};g.ok.addEventListener("click",()=>{d||(d=!0,S(!0))}),g.ng.addEventListener("click",()=>{d||(d=!0,S(!1))})};export{G as default};
